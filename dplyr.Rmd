Can view help by `vignette("dplyr")` and `vignette("two-table")` or check out the [online docs](https://www.rdocumentation.org/packages/dplyr/versions/0.7.8) dplyr is a part of tidyverse

## Filter

Can Use | as or

```{r filter}

library('tidyverse')
table(movies$language)

movies_language <- movies %>% filter(language == "Arabic")
movies_language

moviesSub <- movies %>% filter(language == "English" | language == "Spanish")
moviesBig_Spanish <- movies %>% filter(language == "Spanish" | budget > 1e10)

movies_eng_sp <- movies %>% 
  filter(language == "English" | 
           language == "Spanish") %>%
  filter(budget > 100000000)
dim(movies_eng_sp)

```

## Arange

Order the rows

```{r arrange}
# single column
moviesBig_Spanish <- moviesBig_Spanish %>% arrange(desc(budget))

# arrange via multipe columns
moviesBig_Spanish <- moviesBig_Spanish %>% arrange(desc(budget), desc(title_year))

```

## slice

Only see certain rows

```{r slice}

movies_eng_sp %>% slice(c(35, 70))

moviesBig_Spanish %>% slice(1:10)


```

## select
Used to pick out certain variables

```{r select}

movies_sub <- movies %>% 
  select(movie_title, director_name,
                  gross, budget,)
dim(movies_sub)
names(movies_sub)

movies <- movies %>% 
  select(movie_title, director_name,
         gross, budget, everything())
names(movies)

# using select to programmatically select several variables
moviesActors <- movies %>% select(starts_with("actor"))

```

## Select Helpers

* `starts_with()`: Starts with a prefix.
* `ends_with()`: Ends with a suffix.
* `contains()`: Contains a literal string.
* `matches()`: Matches a regular expression.
* `num_range()`: Matches a numerical range like x01, x02, x03.
* `one_of()`: Matches variable names in a character vector.
* `everything()`: Matches all variables.
* `last_col()`: Select last variable, possibly with an offset.

## rename

```{r rename}

movies <- movies %>% rename(director = director_name)
names(movies)

```

## mutate
```{r mutate}

movies <- movies %>% 
  mutate(budgetM = budget / 1000000,
         grossM = gross / 1000000, 
         profit = grossM - budgetM) %>% 
  filter(budgetM < 400)

```

## group_by

``` {r group_by}
Director_Tot <- movies %>% group_by(director) %>%
  summarize(grossTotDir = sum(grossM, na.rm = TRUE))
head(Director_Tot)
```

## Summerize
```{r summery}
Director_Stats <- movies %>% group_by(director) %>% 
  summarize(
    n = n(),
    min = min(grossM),
    max = max(grossM),
    avg = mean(grossM),
    sd = sd(grossM))

Director_Stats %>% arrange(desc(max)) %>% slice(1:10)
```

## Pulling it together
```{r dplyr_pit}

movies <- movies %>% 
  mutate(genre_main = unlist(map(strsplit(as.character(movies$genres),"\\|"),1)),
         grossM = gross / 1000000,
         budgetM = budget / 1000000, 
         profitM = grossM - budgetM,
         ROI = profitM/budgetM) 
movies <- movies %>% mutate(genre_main = factor(genre_main) %>% fct_drop()) 

Director_Avg <- movies %>%
  group_by(director) %>%
  summarize(num_movies = n(),
            grossAvgDir = mean(grossM,
                               na.rm = TRUE),
            profitAvgDir = mean(profit,
                                na.rm = TRUE))

Director_Avg %>% arrange(desc(profitAvgDir)) %>% 
  filter(num_movies > 1) %>% 
  slice(1:20)

Director_Avg %>% arrange(desc(num_movies)) %>% 
  slice(1:20)

Director_Tot <- movies %>% group_by(director) %>%
  summarize(grossTotDir = sum(grossM, na.rm = TRUE))
genre_collapse <- movies %>%  group_by(genre_main) %>% 
  summarize(Avg_ROI_genre = mean(ROI, na.rm = TRUE),
            SD_ROI_genre = sd(ROI, na.rm = TRUE),
            SE_ROI_genre = sd(ROI, na.rm = TRUE)/sqrt(n()),
            num_films = n())

actor_sum <- movies %>%  group_by(actor_1_name) %>% 
  summarize(Avg_ROI_actor = mean(ROI, na.rm = TRUE),
            SD_ROI_actor = sd(ROI, na.rm = TRUE),
            SE_ROI_actor = sd(ROI, na.rm = TRUE)/sqrt(n()),
            num_films = n())

actor_sum %>% filter(num_films > 2) %>% top_n(5, wt = Avg_ROI_actor)

genre_collapse %>% select(SE_ROI_genre)
genre_collapse$SE_ROI_genre

```