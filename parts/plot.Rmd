## ggplot

`ggplot2` is a system for declaratively creating graphics, based on The [Grammar of Graphics](http://amzn.to/2ef1eWp). You provide the data, tell `ggplot2` how to map variables to aesthetics, what graphical primitives to use, and it takes care of the details.

Itâ€™s hard to succinctly describe how ggplot2 works because it embodies a deep philosophy of visualisation. However, in most cases you start with [ggplot()](https://ggplot2.tidyverse.org/reference/ggplot.html), supply a dataset and aesthetic mapping (with [aes()](https://ggplot2.tidyverse.org/reference/aes.html)). You then add on layers (like [geom_point()](https://ggplot2.tidyverse.org/reference/geom_point.html) or [geom_histogram()](https://ggplot2.tidyverse.org/reference/geom_histogram.html)), scales (like [scale_colour_brewer()](https://ggplot2.tidyverse.org/reference/scale_brewer.html)), faceting specifications (like [facet_wrap()](https://ggplot2.tidyverse.org/reference/facet_wrap.html)) and coordinate systems (like [coord_flip()](https://ggplot2.tidyverse.org/reference/coord_flip.html)).

[CHEATSHEET](https://github.com/rstudio/cheatsheets/blob/master/data-visualization-2.1.pdf)

## Scatter
```{r scatter}

ggplot(mpg, aes(displ, hwy, colour = class)) + 
  geom_point()

ggplot(data = movies) + 
  geom_point(mapping = aes(x = imdb_score, 
                             y = budget) )
```

## Bar Plot

`geom_bar` makes the height of the bar proportional to the number of cases in each group (or if the weight aesthetic is supplied, the sum of the `weights`). If you want the heights of the bars to represent values in the data, use `geom_col()` instead. `geom_bar()` uses `stat_count()` by default: it counts the number of cases at each x position. `geom_col()` uses `stat_identity()`: it leaves the data as is.

```{r bar}
ggplot(gmsc_train, 
       aes(y = SeriousDlqin2yrs, x = age)) + 
  geom_bar(stat = "identity", fill = "red") +
  ggtitle("Serious Delinquencies in 2 years vs By Age") + 
  labs(x = "Age", y = "Serious Delinquencies in 2 years") 

ggplot(gmsc_train, 
       aes(y = SeriousDlqin2yrs, 
           x = NumberRealEstateLoansOrLines)) + 
  geom_col(fill = "red") +
  ggtitle("Serious Delinquencies in 2 years vs Number of Loans or Lines") + 
  labs(x = "Number of Real Estate Loans Or Lines", y = "Serious Delinquencies in 2 years")
```

## Jitter

The jitter geom is a convenient shortcut for `geom_point(position = "jitter")`. It adds a small amount of random variation to the location of each point, and is a useful way of handling overplotting caused by discreteness in smaller datasets.

``` {r jitter}

ggplot(gmsc_train, aes( x = MonthlyIncome, 
                        y = SeriousDlqin2yrs)) + 
  geom_jitter(alpha = 1/10, color = "hotpink") + 
  xlim(0, 100000) +
  ggtitle("Serious Delinquencies in 2 years vs Monthly Income") +
  labs(x = "Monthly Income", y = "Serious Delinquencies in 2 years")
```

## Histogram

Visualise the distribution of a single continuous variable by dividing the x axis into bins and counting the number of observations in each bin. Histograms (`geom_histogram()`) display the counts with bars; frequency polygons (`geom_freqpoly()`) display the counts with lines. Frequency polygons are more suitable when you want to compare the distribution across the levels of a categorical variable.

``` {r histogram} 
ggplot(diamonds, aes(carat)) +
  geom_histogram()
```

## Box Plot

``` {r boxplot}
mpg %>%
  ggplot( aes(x=reorder(class, hwy), y=hwy, fill=class)) + 
    geom_boxplot() +
    xlab("class") +
    theme(legend.position="none")
```

## Line

In a line graph, observations are ordered by x value and connected.

The functions `geom_line()`, `geom_step()`, or `geom_path()` can be used.

x value (for x axis) can be :

* date : for a time series data
* texts
* discrete numeric values
* continuous numeric values

Data derived from ToothGrowth data sets are used. ToothGrowth describes the effect of Vitamin C on tooth growth in Guinea pigs.

* len - Tooth Length
* dose - Dose in mg (0.5, 1, 2)

See more [here](http://www.sthda.com/english/wiki/ggplot2-line-plot-quick-start-guide-r-software-and-data-visualization)

``` {r out.width=c('33%', '33%', '33%'), fig.show='hold'}
df <- data.frame(dose=c("D0.5", "D1", "D2"),
                len=c(4.2, 10, 29.5))
head(df)

# Basic line plot with points
ggplot(data=df, aes(x=dose, y=len, group=1)) +
  geom_line()+
  geom_point()

# Change the line type
ggplot(data=df, aes(x=dose, y=len, group=1)) +
  geom_line(linetype = "dashed")+
  geom_point()

# Change the color
ggplot(data=df, aes(x=dose, y=len, group=1)) +
  geom_line(color="red")+
  geom_point()

```

Observations can be also connected using the functions `geom_step()` or `geom_path()` :

``` {r out.width=c('50%', '50%'), fig.show='hold'}

ggplot(data=df, aes(x=dose, y=len, group=1)) +
  geom_step()+
  geom_point()

ggplot(data=df, aes(x=dose, y=len, group=1)) +
  geom_path()+
  geom_point()

```


## Error Bars
```{r error_setup, echo=FALSE}
movies <- movies %>% filter(budget < 400000000) 
movies <- movies %>% 
  mutate(genre_main = unlist(map(strsplit(as.character(movies$genres),"\\|"),1)),
         grossM = gross / 1000000,
         budgetM = budget / 1000000) 
movies <- movies %>% mutate(genre_main = factor(genre_main) %>% fct_drop()) 
movies <- movies %>% mutate(profitM = grossM - budgetM,
                            ROI = profitM/budgetM)
Genre_ROI <- movies %>% 
  group_by(genre_main) %>% 
  summarize(n = n(), 
            ROI_avg = mean(ROI, na.rm = TRUE), 
            se_ROI = sd(ROI, na.rm = TRUE)/sqrt(n)) %>% 
  arrange(desc(ROI_avg))
```


``` {r error_bars}
ggplot( Genre_ROI, aes(y = ROI_avg, 
                      x = genre_main) ) + 
  geom_bar( stat = "identity" ) + 
  coord_flip() + 
  ggtitle( "Best Performing Genre By ROI" ) + 
  geom_errorbar( mapping = aes( ymin = ROI_avg - se_ROI, 
                                ymax = ROI_avg + se_ROI ) )
```

## Themes {.tabset}
`library("ggthemes")` [docs](https://www.rdocumentation.org/packages/ggthemes/versions/3.5.0)

[Theme Library](https://www.datanovia.com/en/blog/ggplot-themes-gallery/)

Base example
`ggplot() + geom_point(data = iris, aes(x = Petal.Width, y = Petal.Length,color = Species))`
```{r echo=FALSE}
library(ggplot2)
library(ggthemes)

# In this example we will use the open repository of plants classification Iris. 
data("iris")
str(iris)
ggplot() + geom_point(data = iris, aes(x = Petal.Width, y = Petal.Length,color = Species))
```

### ggthemes
```{r}
# For the complete list of themes in the package check
ls("package:ggthemes")[grepl("theme_", ls("package:ggthemes"))]
```

### Calc Theme
```{r}
# Theme similar to the default settings of LibreOffice Calc 
ggplot() + geom_point(data = iris, aes(x = Petal.Width, y = Petal.Length,color = Species)) + theme_calc()
```

### The economist theme
```{r}
# Style plots similar to those in The Economist
ggplot() + geom_point(data = iris, aes(x = Petal.Width, y = Petal.Length,color = Species)) + 
  theme_economist()
```

### The economist white theme
```{r}
# Style plots similar to those in The Economist
ggplot() + geom_point(data = iris, aes(x = Petal.Width, y = Petal.Length,color = Species)) + theme_economist_white()
```

### Few theme
```{r}
# Theme based on the rules and examples in Stephen Few, "Practical rules for using colors in charts"
ggplot() + geom_point(data = iris, aes(x = Petal.Width, y = Petal.Length,color = Species)) + theme_few()
```

### Solarized theme
```{r}
# Check http://ethanschoonover.com/solarized for a description of the solarized palette
ggplot() + geom_point(data = iris, aes(x = Petal.Width, y = Petal.Length,color = Species)) + theme_solarized()
```

### gdocs theme
```{r}
# Theme similar to the default used in google docs
ggplot() + geom_point(data = iris, aes(x = Petal.Width, y = Petal.Length,color = Species)) + theme_gdocs()
```